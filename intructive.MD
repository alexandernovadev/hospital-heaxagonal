# Documentaci√≥n T√©cnica: Sistema de Hospital con DDD y Arquitectura Hexagonal

## üìã √çndice
1. [Arquitectura General](#arquitectura-general)
2. [Contextos Delimitados (Bounded Contexts)](#contextos-delimitados)
3. [Agregados y Entidades](#agregados-y-entidades)
4. [Value Objects](#value-objects)
5. [Servicios de Dominio](#servicios-de-dominio)
6. [Eventos de Dominio](#eventos-de-dominio)
7. [Sistema de Autenticaci√≥n](#sistema-de-autenticaci√≥n)
8. [Estructura del Proyecto](#estructura-del-proyecto)

---

## üèóÔ∏è Arquitectura General

**Arquitectura Hexagonal con DDD** organizada en m√≥dulos por contexto delimitado.

```
src/
‚îú‚îÄ‚îÄ core/                          # Dominio Principal (Core Domain)
‚îú‚îÄ‚îÄ support/                       # Subdominios de Soporte
‚îú‚îÄ‚îÄ shared/                        # Kernel Compartido
‚îî‚îÄ‚îÄ apps/                          # Puertos Primarios (Driving Adapters)
```

---

## ü§ù Kernel Compartido (Shared Kernel)

El Shared Kernel es un conjunto de modelos de dominio (Value Objects, interfaces de eventos, clases base de errores) que son expl√≠citamente compartidos y acordados por m√∫ltiples Contextos Delimitados. Su prop√≥sito es asegurar consistencia en conceptos fundamentales y reducir la duplicaci√≥n de c√≥digo universal, evitando el acoplamiento excesivo entre contextos. Es una parte estable y transversal del dominio.

### Contenido Actual del Shared Kernel:
- `DomainError`: Clase base para todos los errores lanzados dentro de los l√≠mites del dominio.
- `DomainEvent`: Clase base para todos los eventos de dominio, encapsulando metadatos como `eventId` y `occurredOn`.

---

## üß≠ Contextos Delimitados

### 1. **Gesti√≥n de Citas (Appointment Management)**
- **Responsabilidad**: Programaci√≥n y gesti√≥n de citas m√©dicas
- **Agregado Principal**: `Appointment`
- **Lenguaje Ubicuo**: Cita, Programaci√≥n, Disponibilidad

### 2. **Urgencias y Emergencias (Emergency Care)**
- **Responsabilidad**: Atenci√≥n de casos urgentes y triaje
- **Agregado Principal**: `EmergencyEpisode`
- **Lenguaje Ubicuo**: Triaje, Episodio, Urgencia

### 3. **Historia Cl√≠nica (Medical Records)**
- **Responsabilidad**: Gesti√≥n integral de historiales m√©dicos
- **Agregado Principal**: `MedicalRecord`
- **Lenguaje Ubicuo**: Diagn√≥stico, Tratamiento, Historial

### 4. **Gesti√≥n de Recursos (Resource Management)**
- **Responsabilidad**: Administraci√≥n de habitaciones, camas y personal m√©dico (doctores, enfermeras). Aunque `Doctor` y `Nurse` son roles centrales, sus entidades y reglas de asignaci√≥n se gestionan en este contexto.
- **Agregados Principales**: `Room`, `Bed`, `Doctor`, `Nurse`
- **Lenguaje Ubicuo**: Habitaci√≥n, Cama, Turno, Especialidad, Asignaci√≥n de Personal

### 5. **Facturaci√≥n (Billing)**
- **Responsabilidad**: Gesti√≥n de facturas y pagos
- **Agregado Principal**: `Invoice`
- **Lenguaje Ubicuo**: Factura, Pago, Concepto

### 6. **Autenticaci√≥n y Autorizaci√≥n (Auth)**
- **Responsabilidad**: Gesti√≥n de usuarios, roles y permisos en el sistema.
- **Agregados Principales**: `User`, `Role`, `Permission`
- **Lenguaje Ubicuo**: Usuario, Rol, Permiso, Autenticaci√≥n, Autorizaci√≥n

---

## üß© Agregados y Entidades

En DDD, un **Agregado** es un cl√∫ster de entidades y Value Objects que se tratan como una unidad para la consistencia transaccional. Hay una **Ra√≠z de Agregado** que es la √∫nica entidad dentro del agregado que puede ser referenciada desde fuera del mismo, y que garantiza la consistencia de todo el agregado.

### Core Domain
| Entidad (Ra√≠z de Agregado) | Contexto | Responsabilidad |
|--------------------------|----------|-----------------|
| `Patient`                  | Todos    | Representa a un paciente del sistema. Es una entidad central para la mayor√≠a de los contextos. |
| `Appointment`              | Citas    | Gestiona las citas programadas. |
| `EmergencyEpisode`         | Urgencias | Maneja episodios de emergencia. |
| `MedicalRecord`            | Historia Cl√≠nica | Contiene el historial m√©dico completo. |

### Support Subdomains
| Entidad (Ra√≠z de Agregado) | Contexto | Responsabilidad |
|--------------------------|----------|-----------------|
| `Doctor`                   | Recursos | Personal m√©dico con especialidades y reglas de asignaci√≥n. |
| `Nurse`                    | Recursos | Personal de enfermer√≠a con habilidades y disponibilidad. |
| `Room`                     | Recursos | Habitaciones del hospital con estado y capacidad. |
| `Bed`                      | Recursos | Camas asignables a pacientes, con estado. |
| `Invoice`                  | Facturaci√≥n | Facturas y cargos generados, con su estado de pago. |

### Authentication
| Entidad (Ra√≠z de Agregado) | Contexto | Responsabilidad |
|--------------------------|----------|-----------------|
| `User`                     | Auth     | Usuarios del sistema, con credenciales y v√≠nculos a roles/permisos. |
| `Role`                     | Auth     | Definiciones de roles y sus permisos asociados. |
| `Permission`               | Auth     | Definiciones de permisos granulares. |

---

## üéØ Value Objects

### Identificadores
- `PatientId`, `AppointmentId`, `EmergencyEpisodeId`, `MedicalRecordId`
- `DoctorId`, `NurseId`, `RoomId`, `BedId`, `InvoiceId`
- `UserId`, `RoleId`, `PermissionId`

### Datos Personales
- `FullName` (Nombre + Apellido)
- `DateOfBirth` (Fecha nacimiento)
- `DNI` (Documento identidad)
- `ContactInfo` (Email + Tel√©fono)
- `Address` (Direcci√≥n completa)

### M√©dicos
- `AppointmentStatus` (Programada/Confirmada/Cancelada/Completada)
- `TimeSlot` (Franja horaria)
- `AppointmentType` (Tipo de cita)
- `TriageLevel` (Nivel de urgencia)
- `PainScale` (Escala dolor 0-10)
- `VitalSigns` (Signos vitales)
- `BloodType` (Grupo sangu√≠neo)
- `Allergies` (Alergias)

### Recursos
- `Specialty` (Especialidad m√©dica)
- `Shift` (Turno de trabajo)
- `LicenseNumber` (N√∫mero colegiado)
- `RoomNumber` (N√∫mero habitaci√≥n)
- `RoomType` (Tipo habitaci√≥n)
- `RoomStatus` (Estado habitaci√≥n)

### Facturaci√≥n
- `InvoiceStatus` (Estado factura)
- `Currency` (Moneda)
- `InvoiceItem` (Concepto factura)
- `Money` (Cantidad + moneda)

### Autenticaci√≥n
- `Username` (Nombre usuario)
- `PasswordHash` (Hash contrase√±a)
- `JWTToken` (Token JWT)
- `RefreshToken` (Token refresco)

---

## ‚öôÔ∏è Servicios de Dominio

### Gesti√≥n de Citas
- `AppointmentSchedulerService`: Coordina la programaci√≥n de citas

### Urgencias
- `TriageService`: Gestiona el proceso de triaje
- `EmergencyCoordinatorService`: Coordina recursos en urgencias

### Historia Cl√≠nica
- `MedicalRecordService`: Gestiona historiales m√©dicos

### Recursos
- `RoomAssignmentService`: Asigna habitaciones y camas
- `StaffAssignmentService`: Gestiona asignaci√≥n de personal

### Facturaci√≥n
- `BillingService`: Genera y gestiona facturas
- `PaymentProcessingService`: Procesa pagos

### Autenticaci√≥n
- `AuthenticationService`: Gestiona autenticaci√≥n
- `AuthorizationService`: Gestiona autorizaci√≥n
- `PasswordService`: Gestiona contrase√±as
- `TokenService`: Gestiona tokens JWT

---

## üì¢ Eventos de Dominio

### Pacientes y Citas
- `PatientRegisteredEvent`
- `AppointmentScheduledEvent`
- `AppointmentCancelledEvent`

### Urgencias
- `EmergencyAdmissionEvent`
- `TriageCompletedEvent`
- `DiagnosisMadeEvent`
- `TreatmentPrescribedEvent`

### Tratamientos
- `MedicationAdministeredEvent`
- `LabResultsReadyEvent`
- `PatientDischargedEvent`

### Recursos
- `RoomAssignedEvent`
- `SurgeryScheduledEvent`

### Facturaci√≥n
- `InvoiceGeneratedEvent`
- `PaymentReceivedEvent`

### Autenticaci√≥n
- `UserRegisteredEvent`
- `UserLoggedInEvent`
- `UserPasswordChangedEvent`
- `RoleAssignedEvent`

---

## üîê Sistema de Autenticaci√≥n

### Entidades
- `User`: Usuarios del sistema
- `Role`: Roles de permisos
- `Permission`: Permisos espec√≠ficos

### Value Objects
- `UserId`, `RoleId`, `PermissionId`
- `Username`, `PasswordHash`, `Email`
- `JWTToken`, `RefreshToken`

### Servicios
- `AuthenticationService`: Login/logout
- `AuthorizationService`: Control de acceso
- `PasswordService`: Hashing de contrase√±as
- `TokenService`: Gesti√≥n de tokens

### Eventos
- `UserRegisteredEvent`
- `UserLoggedInEvent`
- `UserPasswordChangedEvent`
- `RoleAssignedEvent`
- `PermissionGrantedEvent`

### Pol√≠ticas
- `PasswordComplexityPolicy`: Reglas complejidad contrase√±as
- `TokenExpirationPolicy`: Expiraci√≥n de tokens
- `RoleBasedAccessPolicy`: Control acceso por roles

---

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ appointment/               # Contexto: Citas
‚îÇ   ‚îú‚îÄ‚îÄ emergency/                 # Contexto: Urgencias
‚îÇ   ‚îú‚îÄ‚îÄ medical-record/           # Contexto: Historia Cl√≠nica
‚îÇ   ‚îî‚îÄ‚îÄ patient/                  # Contexto: Pacientes
‚îú‚îÄ‚îÄ support/
‚îÇ   ‚îú‚îÄ‚îÄ billing/                  # Contexto: Facturaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ resource/                 # Contexto: Recursos
‚îÇ   ‚îî‚îÄ‚îÄ auth/                     # Contexto: Autenticaci√≥n
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îú‚îÄ‚îÄ domain/                   # VO compartidos
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/           # Utilidades compartidas
‚îÇ   ‚îî‚îÄ‚îÄ kernel/                   # Kernel compartido
‚îî‚îÄ‚îÄ apps/
    ‚îú‚îÄ‚îÄ api/                      # API REST
    ‚îú‚îÄ‚îÄ worker/                   # Background workers
    ‚îî‚îÄ‚îÄ cli/                      # Herramientas CLI
```

---

## üöÄ Pr√≥ximos Pasos para Desarrollo

1. **Configurar estructura de proyectos** con los m√≥dulos descritos
2. **Implementar Shared Kernel** con VOs base
3. **Cear contextos delimitados** como m√≥dulos independientes
4. **Implementar agregados principales** (Patient, Appointment, etc.)
5. **Desarrollar servicios de dominio** para cada contexto
6. **Configurar sistema de eventos** entre contextos
7. **Implementar autenticaci√≥n** como contexto separado
8. **Crear APIs** para cada contexto delimitado

Cada contexto debe ser desarrollado como un m√≥dulo independiente con su propia capa de aplicaci√≥n, dominio e infraestructura.